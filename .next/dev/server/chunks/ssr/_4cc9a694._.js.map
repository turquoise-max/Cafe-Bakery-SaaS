{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/src/app/dashboard/items/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Item, ItemType, UnitType } from \"@/types/inventory\";\nimport { revalidatePath } from \"next/cache\";\nimport { redirect } from \"next/navigation\";\n\nexport type CreateItemInput = {\n  name: string;\n  code?: string;\n  type: ItemType;\n  base_unit: UnitType;\n  safety_stock?: number;\n  category_id?: string;\n};\n\nexport async function getItems() {\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error(\"Unauthorized\");\n  }\n\n  const { data: userRole } = await supabase\n    .from(\"user_roles\")\n    .select(\"store_id\")\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (!userRole?.store_id) {\n    // redirect(\"/onboarding\");\n    return []; // Return empty items if no store\n  }\n\n  const { data, error } = await supabase\n    .from(\"items\")\n    .select(`\n      *,\n      category:categories(name)\n    `)\n    .eq(\"store_id\", userRole.store_id)\n    .order(\"name\");\n\n  if (error) {\n    console.error(\"Error fetching items:\", error);\n    throw new Error(\"Failed to fetch items\");\n  }\n\n  return data as Item[];\n}\n\nexport async function createItem(input: CreateItemInput) {\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return { error: \"Unauthorized\" };\n  }\n\n  // Get Store ID (Strict Check)\n  const { data: userRole } = await supabase\n    .from(\"user_roles\")\n    .select(\"store_id\")\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (!userRole?.store_id) {\n    return { error: \"Store not found for user\" };\n  }\n\n  const { data, error } = await supabase\n    .from(\"items\")\n    .insert({\n      store_id: userRole.store_id,\n      name: input.name,\n      code: input.code,\n      type: input.type,\n      base_unit: input.base_unit,\n      safety_stock: input.safety_stock, // Supabase handles number -> decimal\n      category_id: input.category_id,\n      is_active: true,\n    })\n    .select()\n    .single();\n\n  if (error) {\n    console.error(\"Error creating item:\", error);\n    return { error: `Failed to create item: ${error.message}` };\n  }\n\n  revalidatePath(\"/dashboard/items\");\n  return { success: true, item: data };\n}\n\nexport async function deleteItem(itemId: string) {\n  const supabase = await createClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return { error: \"Unauthorized\" };\n  }\n\n  // Get user's store for ownership check\n  const { data: userRole } = await supabase\n    .from(\"user_roles\")\n    .select(\"store_id\")\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (!userRole?.store_id) {\n    return { error: \"Store not found for user\" };\n  }\n\n  // Delete only if item belongs to user's store\n  const { error } = await supabase\n    .from(\"items\")\n    .delete()\n    .eq(\"id\", itemId)\n    .eq(\"store_id\", userRole.store_id);\n\n  if (error) {\n    return { error: error.message };\n  }\n\n  revalidatePath(\"/dashboard/items\");\n  return { success: true };\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/.next-internal/server/app/dashboard/items/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getItems as '001aea836daf26be9195c23c5625652d6dbba4322f'} from 'ACTIONS_MODULE0'\nexport {deleteItem as '402f3cfe50d32bb556d90c95dc56e19679ab92f2c2'} from 'ACTIONS_MODULE0'\nexport {createItem as '40e564b33b2354f68726dd75c1c6eb83c39fdb0f17'} from 'ACTIONS_MODULE0'\nexport {createItem as '40e564b33b2354f68726dd75c1c6eb83c39fdb0f17'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}