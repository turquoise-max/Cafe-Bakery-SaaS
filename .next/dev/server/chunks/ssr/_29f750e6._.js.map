{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/src/app/onboarding/actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { redirect } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/server'\n\nexport type State = {\n  message?: string | null\n  errors?: {\n    orgName?: string[]\n    storeName?: string[]\n    storeType?: string[]\n  }\n}\n\nexport async function createOrganizationAndStore(prevState: State, formData: FormData): Promise<State> {\n  const supabase = await createClient()\n\n  // 1. Authenticate User\n  const {\n    data: { user },\n    error: userError,\n  } = await supabase.auth.getUser()\n\n  if (userError || !user) {\n    redirect('/login')\n  }\n\n  // 2. Validate Input\n  const orgName = formData.get('orgName') as string\n  const storeName = formData.get('storeName') as string\n  const storeType = formData.get('storeType') as string\n  const includeSampleData = formData.get('includeSampleData') === 'on'\n\n  const errors: State['errors'] = {}\n  if (!orgName) {\n    errors.orgName = ['Organization name is required.']\n  }\n  if (!storeName) {\n    errors.storeName = ['Store name is required.']\n  }\n  if (!storeType) {\n    errors.storeType = ['Store type is required.']\n  }\n\n  if (Object.keys(errors).length > 0) {\n    return {\n      errors,\n      message: 'Missing Fields. Failed to Create Organization and Store.',\n    }\n  }\n\n  // 3. Call RPC function for transactional creation\n  const { data, error } = await supabase.rpc('create_initial_organization_v2', {\n    p_org_name: orgName,\n    p_store_name: storeName,\n    p_store_type: storeType,\n    p_include_sample_data: includeSampleData,\n  })\n\n  if (error) {\n    console.error('Failed to create organization and store:', error)\n    return {\n      message: 'Failed to create organization and store. Please try again.',\n    }\n  }\n\n  // Check if organization already exists (idempotency)\n  if (data && (data as any).already_exists) {\n    console.log('Organization already exists for user, redirecting to dashboard.')\n  }\n\n  // 4. Revalidate and Redirect\n  // Clear all caches to ensure the new role is recognized\n  revalidatePath('/', 'layout')\n  redirect('/dashboard')\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;;;;;;AAWO,eAAe,2BAA2B,SAAgB,EAAE,QAAkB;IACnF,MAAM,WAAW,MAAM,IAAA,gJAAY;IAEnC,uBAAuB;IACvB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,aAAa,CAAC,MAAM;QACtB,IAAA,iMAAQ,EAAC;IACX;IAEA,oBAAoB;IACpB,MAAM,UAAU,SAAS,GAAG,CAAC;IAC7B,MAAM,YAAY,SAAS,GAAG,CAAC;IAC/B,MAAM,YAAY,SAAS,GAAG,CAAC;IAC/B,MAAM,oBAAoB,SAAS,GAAG,CAAC,yBAAyB;IAEhE,MAAM,SAA0B,CAAC;IACjC,IAAI,CAAC,SAAS;QACZ,OAAO,OAAO,GAAG;YAAC;SAAiC;IACrD;IACA,IAAI,CAAC,WAAW;QACd,OAAO,SAAS,GAAG;YAAC;SAA0B;IAChD;IACA,IAAI,CAAC,WAAW;QACd,OAAO,SAAS,GAAG;YAAC;SAA0B;IAChD;IAEA,IAAI,OAAO,IAAI,CAAC,QAAQ,MAAM,GAAG,GAAG;QAClC,OAAO;YACL;YACA,SAAS;QACX;IACF;IAEA,kDAAkD;IAClD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,kCAAkC;QAC3E,YAAY;QACZ,cAAc;QACd,cAAc;QACd,uBAAuB;IACzB;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,4CAA4C;QAC1D,OAAO;YACL,SAAS;QACX;IACF;IAEA,qDAAqD;IACrD,IAAI,QAAQ,AAAC,KAAa,cAAc,EAAE;QACxC,QAAQ,GAAG,CAAC;IACd;IAEA,6BAA6B;IAC7B,wDAAwD;IACxD,IAAA,+IAAc,EAAC,KAAK;IACpB,IAAA,iMAAQ,EAAC;AACX;;;IA7DsB;;AAAA,+OAAA"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/.next-internal/server/app/onboarding/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createOrganizationAndStore as '607bb79c7742f76a40c05967138945c74214f10e7b'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}