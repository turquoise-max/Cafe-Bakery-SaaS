{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/src/app/onboarding/actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { redirect } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/server'\n\nexport type State = {\n  message?: string | null\n  errors?: {\n    orgName?: string[]\n    storeName?: string[]\n  }\n}\n\nexport async function createOrganizationAndStore(prevState: State, formData: FormData): Promise<State> {\n  const supabase = await createClient()\n\n  // 1. Authenticate User\n  const {\n    data: { user },\n    error: userError,\n  } = await supabase.auth.getUser()\n\n  if (userError || !user) {\n    redirect('/login')\n  }\n\n  // 2. Validate Input\n  const orgName = formData.get('orgName') as string\n  const storeName = formData.get('storeName') as string\n\n  const errors: State['errors'] = {}\n  if (!orgName) {\n    errors.orgName = ['Organization name is required.']\n  }\n  if (!storeName) {\n    errors.storeName = ['Store name is required.']\n  }\n\n  if (Object.keys(errors).length > 0) {\n    return {\n      errors,\n      message: 'Missing Fields. Failed to Create Organization and Store.',\n    }\n  }\n\n  // 3. Call RPC function for transactional creation\n  const { data, error } = await supabase.rpc('create_initial_organization', {\n    p_org_name: orgName,\n    p_store_name: storeName,\n  })\n\n  if (error) {\n    console.error('Failed to create organization and store:', error)\n    return {\n      message: 'Failed to create organization and store. Please try again.',\n    }\n  }\n\n  // Check if organization already exists (idempotency)\n  if (data && (data as any).already_exists) {\n    console.log('Organization already exists for user, redirecting to dashboard.')\n  }\n\n  // 4. Revalidate and Redirect\n  // Clear all caches to ensure the new role is recognized\n  revalidatePath('/', 'layout')\n  redirect('/dashboard')\n}\n"],"names":[],"mappings":";;;;;;;MAcsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,8DAAA"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/src/components/onboarding/onboarding-form.tsx"],"sourcesContent":["'use client'\n\nimport { useActionState } from 'react'\nimport { createOrganizationAndStore, State } from '@/app/onboarding/actions'\n\nconst initialState: State = {\n  message: null,\n  errors: {},\n}\n\nexport default function OnboardingForm() {\n  const [state, formAction, isPending] = useActionState(createOrganizationAndStore, initialState)\n\n  return (\n    <div className=\"flex min-h-screen flex-col justify-center px-6 py-12 lg:px-8 bg-gray-50\">\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-sm\">\n        <h2 className=\"mt-10 text-center text-2xl font-bold leading-9 tracking-tight text-gray-900\">\n          서비스 시작하기\n        </h2>\n        <p className=\"mt-2 text-center text-sm text-gray-600\">\n          서비스 이용을 위해 조직과 첫 번째 매장을 생성해주세요.\n        </p>\n      </div>\n\n      <div className=\"mt-10 sm:mx-auto sm:w-full sm:max-w-sm\">\n        <form className=\"space-y-6\" action={formAction}>\n          <div>\n            <label htmlFor=\"orgName\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n              조직명 (회사/브랜드명)\n            </label>\n            <div className=\"mt-2\">\n              <input\n                id=\"orgName\"\n                name=\"orgName\"\n                type=\"text\"\n                required\n                placeholder=\"예: BSM 베이커리\"\n                className=\"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3\"\n                aria-describedby=\"orgName-error\"\n              />\n            </div>\n            {state.errors?.orgName && (\n              <p id=\"orgName-error\" className=\"mt-2 text-sm text-red-600\">\n                {state.errors.orgName.join(', ')}\n              </p>\n            )}\n          </div>\n\n          <div>\n            <label htmlFor=\"storeName\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n              첫 번째 매장명\n            </label>\n            <div className=\"mt-2\">\n              <input\n                id=\"storeName\"\n                name=\"storeName\"\n                type=\"text\"\n                required\n                placeholder=\"예: 본점\"\n                className=\"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3\"\n                aria-describedby=\"storeName-error\"\n              />\n            </div>\n            {state.errors?.storeName && (\n              <p id=\"storeName-error\" className=\"mt-2 text-sm text-red-600\">\n                {state.errors.storeName.join(', ')}\n              </p>\n            )}\n          </div>\n\n          {state.message && (\n            <div className=\"rounded-md bg-red-50 p-4\">\n              <div className=\"flex\">\n                <div className=\"text-sm text-red-700\">{state.message}</div>\n              </div>\n            </div>\n          )}\n\n          <div>\n            <button\n              type=\"submit\"\n              disabled={isPending}\n              className=\"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:bg-indigo-400\"\n            >\n              {isPending ? '생성 중...' : '시작하기'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}"],"names":["c","_c","useActionState","createOrganizationAndStore","State","initialState","message","errors","OnboardingForm","$","$i","Symbol","for","state","formAction","isPending","t0","t1","t2","t3","orgName","join","t4","t5","t6","t7","storeName","t8","t9","t10","t11","t12"],"mappings":"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","ignoreList":[]}},
    {"offset": {"line": 342, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Proj/cafe-bakery-saas/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0]}}]
}