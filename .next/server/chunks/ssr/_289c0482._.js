module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},28515,a=>{"use strict";var b=a.i(37936),c=a.i(16349),d=a.i(18558);async function e(a){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{error:"Unauthorized"};let{data:f}=await b.from("user_roles").select("store_id").eq("user_id",e.id).single();if(!f?.store_id)return{error:"Store not found"};let g=f.store_id,{outputItemId:h,outputQuantity:i,items:j,name:k,description:l}=a;if(j.some(a=>a.inputItemId===h))return{error:"Self-reference detected: Output item cannot be an ingredient."};let{data:m,error:n}=await b.from("recipes").select("version").eq("store_id",g).eq("output_item_id",h).order("version",{ascending:!1}).limit(1);if(n)return{error:`Version check failed: ${n.message}`};let o=m&&m.length>0?m[0].version+1:1,{data:p,error:q}=await b.from("recipes").insert({store_id:g,output_item_id:h,output_quantity:i,version:o,is_active:!0,name:k,description:l}).select().single();if(q)return{error:`Recipe creation failed: ${q.message}`};if(j.length>0){let a=j.map((a,b)=>({recipe_id:p.id,input_item_id:a.inputItemId,quantity:a.quantity,unit:a.unit,sort_order:b})),{error:c}=await b.from("recipe_items").insert(a);if(c)return await b.from("recipes").delete().eq("id",p.id),{error:`Failed to add ingredients: ${c.message}`}}let{error:r}=await b.from("recipes").update({is_active:!1}).eq("store_id",g).eq("output_item_id",h).neq("id",p.id);return r&&console.error("Failed to deactivate old recipes:",r),(0,d.revalidatePath)("/dashboard/recipes"),{success:!0,recipeId:p.id}}async function f(a){let b=await (0,c.createClient)(),d=0,e=a.map(a=>a.inputItemId),{data:f}=await b.from("items").select("id, base_unit, latest_purchase_price").in("id",e);if(!f)return 0;for(let c of a){let a=f.find(a=>a.id===c.inputItemId);if(!a||!a.latest_purchase_price)continue;let{data:e}=await b.rpc("convert_unit",{p_quantity:c.quantity,p_from_unit:c.unit,p_to_unit:a.base_unit,p_item_id:c.inputItemId});null!==e&&(d+=e*a.latest_purchase_price)}return d}async function g(){let a=await (0,c.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return[];let{data:d}=await a.from("user_roles").select("store_id").eq("user_id",b.id).single();if(!d?.store_id)return[];let{data:e}=await a.from("recipes").select(`
      *,
      output_item:items!output_item_id(name, code, base_unit),
      recipe_items(
        quantity,
        unit,
        input_item:items!input_item_id(name, base_unit, latest_purchase_price)
      )
    `).eq("store_id",d.store_id).eq("is_active",!0).order("created_at",{ascending:!1});return e||[]}(0,a.i(13095).ensureServerEntryExports)([e,f,g]),(0,b.registerServerReference)(e,"4057c0cbc5ca48737df82f1073933b664183b4c1e9",null),(0,b.registerServerReference)(f,"40db8656ca4dd856b0cf87c27963b45d24b1859875",null),(0,b.registerServerReference)(g,"005e74f9cabeaa4c50f6d31fcc0d11a9eb8a2554e9",null),a.s(["calculateRecipeCost",()=>f,"createRecipe",()=>e,"getRecipes",()=>g])},49604,a=>{"use strict";var b=a.i(28515);a.s([],7388),a.i(7388),a.s(["005e74f9cabeaa4c50f6d31fcc0d11a9eb8a2554e9",()=>b.getRecipes,"4057c0cbc5ca48737df82f1073933b664183b4c1e9",()=>b.createRecipe,"40db8656ca4dd856b0cf87c27963b45d24b1859875",()=>b.calculateRecipeCost],49604)}];

//# sourceMappingURL=_289c0482._.js.map