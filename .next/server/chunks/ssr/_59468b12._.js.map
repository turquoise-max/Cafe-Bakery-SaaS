{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/app/dashboard/items/actions.ts","../../../../.next-internal/server/app/dashboard/items/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","\"use server\";\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Item, ItemType, UnitType } from \"@/types/inventory\";\nimport { revalidatePath } from \"next/cache\";\nimport { redirect } from \"next/navigation\";\n\nexport type CreateItemInput = {\n  name: string;\n  code?: string;\n  type: ItemType;\n  base_unit: UnitType;\n  safety_stock?: number;\n  category_id?: string;\n};\n\nexport async function getItems() {\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error(\"Unauthorized\");\n  }\n\n  const { data: userRole } = await supabase\n    .from(\"user_roles\")\n    .select(\"store_id\")\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (!userRole?.store_id) {\n    // redirect(\"/onboarding\");\n    return []; // Return empty items if no store\n  }\n\n  const { data, error } = await supabase\n    .from(\"items\")\n    .select(`\n      *,\n      category:categories(name)\n    `)\n    .eq(\"store_id\", userRole.store_id)\n    .order(\"name\");\n\n  if (error) {\n    console.error(\"Error fetching items:\", error);\n    throw new Error(\"Failed to fetch items\");\n  }\n\n  return data as Item[];\n}\n\nexport async function createItem(input: CreateItemInput) {\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return { error: \"Unauthorized\" };\n  }\n\n  // Get Store ID (Strict Check)\n  const { data: userRole } = await supabase\n    .from(\"user_roles\")\n    .select(\"store_id\")\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (!userRole?.store_id) {\n    return { error: \"Store not found for user\" };\n  }\n\n  const { data, error } = await supabase\n    .from(\"items\")\n    .insert({\n      store_id: userRole.store_id,\n      name: input.name,\n      code: input.code,\n      type: input.type,\n      base_unit: input.base_unit,\n      safety_stock: input.safety_stock, // Supabase handles number -> decimal\n      category_id: input.category_id,\n      is_active: true,\n    })\n    .select()\n    .single();\n\n  if (error) {\n    console.error(\"Error creating item:\", error);\n    return { error: `Failed to create item: ${error.message}` };\n  }\n\n  revalidatePath(\"/dashboard/items\");\n  return { success: true, item: data };\n}\n\nexport async function deleteItem(itemId: string) {\n  const supabase = await createClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return { error: \"Unauthorized\" };\n  }\n\n  // Get user's store for ownership check\n  const { data: userRole } = await supabase\n    .from(\"user_roles\")\n    .select(\"store_id\")\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (!userRole?.store_id) {\n    return { error: \"Store not found for user\" };\n  }\n\n  // Delete only if item belongs to user's store\n  const { error } = await supabase\n    .from(\"items\")\n    .delete()\n    .eq(\"id\", itemId)\n    .eq(\"store_id\", userRole.store_id);\n\n  if (error) {\n    return { error: error.message };\n  }\n\n  revalidatePath(\"/dashboard/items\");\n  return { success: true };\n}","export {getItems as '0032a9292fd658e87efa1a3bdfe53febeb39ebd0fe'} from 'ACTIONS_MODULE0'\nexport {deleteItem as '405587be46d836851ba73f18c1a41bdd1627263589'} from 'ACTIONS_MODULE0'\nexport {createItem as '40757eb82f73ab6c0b123ae36dd618a65b81e4c38f'} from 'ACTIONS_MODULE0'\nexport {createItem as '40757eb82f73ab6c0b123ae36dd618a65b81e4c38f'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}