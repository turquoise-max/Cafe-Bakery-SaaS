# F&B ë§¤ì¥ ê´€ë¦¬ SaaS - í†µí•© DB ì„¤ê³„

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ ERD](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#1-%EC%A0%84%EC%B2%B4-erd)
2. [í…Œì´ë¸” ëª©ë¡ ë° ê´€ê³„](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#2-%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%AA%A9%EB%A1%9D-%EB%B0%8F-%EA%B4%80%EA%B3%84)
3. [ì „ì²´ SQL ìŠ¤í¬ë¦½íŠ¸](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#3-%EC%A0%84%EC%B2%B4-sql-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8)
4. [ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#4-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98-%EC%88%9C%EC%84%9C)
5. [ì´ˆê¸° ë°ì´í„°](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#5-%EC%B4%88%EA%B8%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0)
6. [RLS ì •ì±… ì „ì²´](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#6-rls-%EC%A0%95%EC%B1%85-%EC%A0%84%EC%B2%B4)
7. [ì¸ë±ìŠ¤ ì „ëµ](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#7-%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%A0%84%EB%9E%B5)
8. [ë·° ë° í•¨ìˆ˜](https://claude.ai/chat/fadf1908-5a16-4df3-b390-ee6d40ea1017#8-%EB%B7%B0-%EB%B0%8F-%ED%95%A8%EC%88%98)

---

## 1. ì „ì²´ ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MULTI-TENANCY LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  organizations   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚     stores       â”‚                    â”‚
â”‚  â”‚  - id            â”‚  1:N    â”‚  - id            â”‚                    â”‚
â”‚  â”‚  - name          â”‚         â”‚  - org_id        â”‚                    â”‚
â”‚  â”‚  - subscription  â”‚         â”‚  - name          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                         â”‚                               â”‚
â”‚                                         â”‚ M:N                          â”‚
â”‚                                         â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      users       â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   user_roles     â”‚                    â”‚
â”‚  â”‚  - id            â”‚  1:N    â”‚  - user_id       â”‚                    â”‚
â”‚  â”‚  - email         â”‚         â”‚  - store_id      â”‚                    â”‚
â”‚  â”‚  - name          â”‚         â”‚  - role          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRODUCT & BOM LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   categories     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚      items       â”‚                    â”‚
â”‚  â”‚  - id            â”‚  1:N    â”‚  - id            â”‚                    â”‚
â”‚  â”‚  - name          â”‚         â”‚  - store_id      â”‚                    â”‚
â”‚  â”‚  - parent_id     â”‚         â”‚  - type (enum)   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  - base_unit     â”‚                    â”‚
â”‚                                â”‚  - sale_price    â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                         â”‚                               â”‚
â”‚                                         â”‚ 1:N                          â”‚
â”‚                                         â”‚                               â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                                â”‚     recipes      â”‚                    â”‚
â”‚                                â”‚  - id            â”‚                    â”‚
â”‚                                â”‚  - output_item   â”‚                    â”‚
â”‚                                â”‚  - version       â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                         â”‚                               â”‚
â”‚                                         â”‚ 1:N                          â”‚
â”‚                                         â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      items       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚  recipe_items    â”‚                    â”‚
â”‚  â”‚  (ì¬ë£Œë¡œ ì°¸ì¡°)    â”‚  N:1    â”‚  - recipe_id     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  - input_item_id â”‚                    â”‚
â”‚                                â”‚  - quantity      â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  item_options    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚      items       â”‚                    â”‚
â”‚  â”‚  - id            â”‚  N:1    â”‚                  â”‚                    â”‚
â”‚  â”‚  - item_id       â”‚         â”‚  (ì˜µì…˜ ëŒ€ìƒ)      â”‚                    â”‚
â”‚  â”‚  - option_name   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  â”‚  - additional_*  â”‚                                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INVENTORY LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      items       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚    inventory     â”‚                    â”‚
â”‚  â”‚                  â”‚  1:1    â”‚  - store_id      â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  - item_id       â”‚                    â”‚
â”‚                                â”‚  - theoretical_  â”‚                    â”‚
â”‚                                â”‚    quantity      â”‚                    â”‚
â”‚                                â”‚  - physical_     â”‚                    â”‚
â”‚                                â”‚    quantity      â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                         â”‚                               â”‚
â”‚                                         â”‚ 1:N                          â”‚
â”‚                                         â”‚                               â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                       â”‚                 â”‚                 â”‚            â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚inventory_trans   â”‚ â”‚inventory_  â”‚ â”‚ physical_counts â”‚  â”‚
â”‚             â”‚  - item_id       â”‚ â”‚  lots      â”‚ â”‚  - store_id     â”‚  â”‚
â”‚             â”‚  - type (enum)   â”‚ â”‚  - item_id â”‚ â”‚  - count_date   â”‚  â”‚
â”‚             â”‚  - quantity      â”‚ â”‚  - lot_num â”‚ â”‚  - zone         â”‚  â”‚
â”‚             â”‚  - reference_*   â”‚ â”‚  - expiry  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚            â”‚
â”‚                                                           â”‚ 1:N        â”‚
â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                                  â”‚physical_count_  â”‚  â”‚
â”‚                                                  â”‚  items          â”‚  â”‚
â”‚                                                  â”‚  - item_id      â”‚  â”‚
â”‚                                                  â”‚  - counted_qty  â”‚  â”‚
â”‚                                                  â”‚  - variance     â”‚  â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PURCHASE LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚    suppliers     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚ purchase_orders  â”‚                    â”‚
â”‚  â”‚  - id            â”‚  1:N    â”‚  - id            â”‚                    â”‚
â”‚  â”‚  - store_id      â”‚         â”‚  - supplier_id   â”‚                    â”‚
â”‚  â”‚  - name          â”‚         â”‚  - status (enum) â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                         â”‚                               â”‚
â”‚                                         â”‚ 1:N                          â”‚
â”‚                                         â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      items       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚ purchase_order_  â”‚                    â”‚
â”‚  â”‚                  â”‚  N:1    â”‚   items          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  - po_id         â”‚                    â”‚
â”‚                                â”‚  - item_id       â”‚                    â”‚
â”‚                                â”‚  - ordered_qty   â”‚                    â”‚
â”‚                                â”‚  - received_qty  â”‚                    â”‚
â”‚                                â”‚  - expiry_date   â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SALES LAYER                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                                â”‚      sales       â”‚                    â”‚
â”‚                                â”‚  - id            â”‚                    â”‚
â”‚                                â”‚  - store_id      â”‚                    â”‚
â”‚                                â”‚  - channel       â”‚                    â”‚
â”‚                                â”‚  - total_amount  â”‚                    â”‚
â”‚                                â”‚  - sale_date     â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                         â”‚                               â”‚
â”‚                                         â”‚ 1:N                          â”‚
â”‚                                         â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      items       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚   sales_items    â”‚                    â”‚
â”‚  â”‚                  â”‚  N:1    â”‚  - sale_id       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  - item_id       â”‚                    â”‚
â”‚                                â”‚  - quantity      â”‚                    â”‚
â”‚                                â”‚  - options(JSON) â”‚                    â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UTILITY LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚           unit_conversions                               â”‚          â”‚
â”‚  â”‚  - from_unit (enum)                                      â”‚          â”‚
â”‚  â”‚  - to_unit (enum)                                        â”‚          â”‚
â”‚  â”‚  - conversion_factor                                     â”‚          â”‚
â”‚  â”‚  - item_id (nullable - ë²”ìš© ë˜ëŠ” í’ˆëª©ë³„)                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. í…Œì´ë¸” ëª©ë¡ ë° ê´€ê³„

### 2.1 Multi-tenancy ê³„ì¸µ (4ê°œ)

| í…Œì´ë¸” | ì„¤ëª… | ê´€ê³„ |
| --- | --- | --- |
| organizations | íšŒì‚¬/ë³¸ì‚¬ | 1:N â†’ stores |
| stores | ë§¤ì¥ | M:N â†” users (via user_roles) |
| users | ì‚¬ìš©ì | 1:N â†’ user_roles |
| user_roles | ê¶Œí•œ ì—°ê²° | N:1 â†’ stores, users |

### 2.2 ì œí’ˆ & BOM ê³„ì¸µ (5ê°œ)

| í…Œì´ë¸” | ì„¤ëª… | ê´€ê³„ |
| --- | --- | --- |
| categories | ì¹´í…Œê³ ë¦¬ | 1:N â†’ items |
| items | í’ˆëª© ë§ˆìŠ¤í„° (ì›ìì¬/ë°˜ì œí’ˆ/ì™„ì œí’ˆ) | N:1 â† recipes, recipe_items |
| recipes | ë ˆì‹œí”¼ í—¤ë” | 1:N â†’ recipe_items |
| recipe_items | ë ˆì‹œí”¼ ìƒì„¸ (BOM) | N:1 â†’ items (ì¬ë£Œ) |
| item_options | ì œí’ˆ ì˜µì…˜ | N:1 â†’ items |

### 2.3 ì¬ê³  ê´€ë¦¬ ê³„ì¸µ (4ê°œ)

| í…Œì´ë¸” | ì„¤ëª… | ê´€ê³„ |
| --- | --- | --- |
| inventory | í˜„ì¬ ì¬ê³  | 1:1 â†” items |
| inventory_transactions | ì¬ê³  ì´ë™ ë‚´ì—­ | N:1 â†’ items |
| inventory_lots | FIFO ë¡œíŠ¸ ê´€ë¦¬ | N:1 â†’ items |
| physical_counts | ì‹¤ì‚¬ í—¤ë” | 1:N â†’ physical_count_items |
| physical_count_items | ì‹¤ì‚¬ ìƒì„¸ | N:1 â†’ items |

### 2.4 êµ¬ë§¤ ê´€ë¦¬ ê³„ì¸µ (3ê°œ)

| í…Œì´ë¸” | ì„¤ëª… | ê´€ê³„ |
| --- | --- | --- |
| suppliers | ê±°ë˜ì²˜ | 1:N â†’ purchase_orders |
| purchase_orders | ë°œì£¼ í—¤ë” | 1:N â†’ purchase_order_items |
| purchase_order_items | ë°œì£¼ ìƒì„¸ | N:1 â†’ items |

### 2.5 íŒë§¤ ê´€ë¦¬ ê³„ì¸µ (2ê°œ)

| í…Œì´ë¸” | ì„¤ëª… | ê´€ê³„ |
| --- | --- | --- |
| sales | íŒë§¤ í—¤ë” | 1:N â†’ sales_items |
| sales_items | íŒë§¤ ìƒì„¸ | N:1 â†’ items |

### 2.6 ìœ í‹¸ë¦¬í‹° (1ê°œ)

| í…Œì´ë¸” | ì„¤ëª… |
| --- | --- |
| unit_conversions | ë‹¨ìœ„ ë³€í™˜ í…Œì´ë¸” |

**ì´ 19ê°œ í…Œì´ë¸”**

---

## 3. ì „ì²´ SQL ìŠ¤í¬ë¦½íŠ¸

### 3.1 ENUM íƒ€ì… ì •ì˜

```sql
-- í’ˆëª© íƒ€ì…
CREATE TYPE item_type AS ENUM ('raw', 'semi_finished', 'finished');

-- ë‹¨ìœ„
CREATE TYPE unit_type AS ENUM ('kg', 'g', 'l', 'ml', 'ea', 'box', 'pack');

-- ì¬ê³  ê±°ë˜ íƒ€ì…
CREATE TYPE transaction_type AS ENUM (
  'purchase',      -- ì…ê³ 
  'sale',          -- íŒë§¤ ì¶œê³ 
  'adjustment',    -- ì¡°ì • (ì‹¤ì‚¬ í›„)
  'waste',         -- íê¸°
  'production',    -- ìƒì‚°
  'transfer'       -- ë§¤ì¥ ê°„ ì´ë™
);

-- ë°œì£¼ ìƒíƒœ
CREATE TYPE po_status AS ENUM ('draft', 'ordered', 'received', 'cancelled');
```

### 3.2 Multi-tenancy í…Œì´ë¸”

```sql
-- ============================================
-- 1. Organizations (íšŒì‚¬/ë³¸ì‚¬)
-- ============================================
CREATE TABLE organizations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name VARCHAR(255) NOT NULL,
  slug VARCHAR(100) UNIQUE NOT NULL,
  business_number VARCHAR(20),

  -- êµ¬ë… ì •ë³´
  subscription_plan VARCHAR(50) DEFAULT 'trial',
  subscription_status VARCHAR(20) DEFAULT 'active',
  trial_ends_at TIMESTAMP,
  subscription_started_at TIMESTAMP,
  subscription_ends_at TIMESTAMP,

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ============================================
-- 2. Stores (ë§¤ì¥)
-- ============================================
CREATE TABLE stores (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,

  name VARCHAR(255) NOT NULL,
  code VARCHAR(50),

  -- ìœ„ì¹˜ ì •ë³´
  address TEXT,
  latitude DECIMAL(10, 8),
  longitude DECIMAL(11, 8),
  timezone VARCHAR(50) DEFAULT 'Asia/Seoul',

  -- ìš´ì˜ ì •ë³´
  phone VARCHAR(20),
  is_active BOOLEAN DEFAULT true,
  opening_date DATE,

  settings JSONB DEFAULT '{}',

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_stores_org ON stores(organization_id);
CREATE INDEX idx_stores_code ON stores(organization_id, code);

-- ============================================
-- 3. Users (ì‚¬ìš©ì)
-- ============================================
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- ì¸ì¦ ì •ë³´
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255),

  -- í”„ë¡œí•„
  name VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  avatar_url TEXT,

  -- ì†Œì…œ ë¡œê·¸ì¸
  google_id VARCHAR(255) UNIQUE,
  kakao_id VARCHAR(255) UNIQUE,
  naver_id VARCHAR(255) UNIQUE,

  last_login_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_social ON users(google_id, kakao_id, naver_id);

-- ============================================
-- 4. User_Roles (ê¶Œí•œ ì—°ê²°)
-- ============================================
CREATE TABLE user_roles (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  store_id UUID REFERENCES stores(id) ON DELETE CASCADE,

  role VARCHAR(50) NOT NULL, -- 'super_admin', 'owner', 'manager', 'staff'
  permissions JSONB DEFAULT '{}',

  created_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(user_id, store_id)
);

CREATE INDEX idx_user_roles_user ON user_roles(user_id);
CREATE INDEX idx_user_roles_store ON user_roles(store_id);
```

### 3.3 ì œí’ˆ & BOM í…Œì´ë¸”

```sql
-- ============================================
-- 5. Categories (ì¹´í…Œê³ ë¦¬)
-- ============================================
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  name VARCHAR(100) NOT NULL,
  parent_id UUID REFERENCES categories(id),
  display_order INT DEFAULT 0,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_categories_store ON categories(store_id);
CREATE INDEX idx_categories_parent ON categories(parent_id);

-- ============================================
-- 6. Items (í’ˆëª© ë§ˆìŠ¤í„°)
-- ============================================
CREATE TABLE items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  -- ê¸°ë³¸ ì •ë³´
  code VARCHAR(50),
  name VARCHAR(255) NOT NULL,
  name_en VARCHAR(255),

  -- ë¶„ë¥˜
  type item_type NOT NULL,
  category_id UUID REFERENCES categories(id),

  -- ë‹¨ìœ„ ì •ë³´
  base_unit unit_type NOT NULL,
  purchase_unit unit_type,

  -- ê°€ê²© ì •ë³´
  sale_price DECIMAL(10, 2),
  latest_purchase_price DECIMAL(10, 2),

  -- ì¬ê³  ê´€ë¦¬
  is_inventory_managed BOOLEAN DEFAULT true,
  safety_stock DECIMAL(10, 3),

  -- ë©”íƒ€ë°ì´í„°
  description TEXT,
  image_url TEXT,
  is_active BOOLEAN DEFAULT true,

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_items_store ON items(store_id);
CREATE INDEX idx_items_type ON items(store_id, type);
CREATE INDEX idx_items_code ON items(store_id, code);
CREATE INDEX idx_items_category ON items(category_id);

-- ============================================
-- 7. Recipes (ë ˆì‹œí”¼)
-- ============================================
CREATE TABLE recipes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  output_item_id UUID NOT NULL REFERENCES items(id) ON DELETE CASCADE,
  output_quantity DECIMAL(10, 3) NOT NULL DEFAULT 1,

  -- ë²„ì „ ê´€ë¦¬
  version INT NOT NULL DEFAULT 1,
  is_active BOOLEAN DEFAULT true,

  name VARCHAR(255),
  description TEXT,
  notes TEXT,

  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(store_id, output_item_id, version)
);

CREATE INDEX idx_recipes_output ON recipes(output_item_id);
CREATE INDEX idx_recipes_active ON recipes(store_id, output_item_id, is_active);

-- ============================================
-- 8. Recipe_Items (BOM ìƒì„¸)
-- ============================================
CREATE TABLE recipe_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  recipe_id UUID NOT NULL REFERENCES recipes(id) ON DELETE CASCADE,

  input_item_id UUID NOT NULL REFERENCES items(id) ON DELETE RESTRICT,
  quantity DECIMAL(10, 3) NOT NULL,
  unit unit_type NOT NULL,

  sort_order INT DEFAULT 0,
  is_optional BOOLEAN DEFAULT false,
  notes TEXT,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_recipe_items_recipe ON recipe_items(recipe_id);
CREATE INDEX idx_recipe_items_input ON recipe_items(input_item_id);

-- ============================================
-- 9. Item_Options (ì œí’ˆ ì˜µì…˜)
-- ============================================
CREATE TABLE item_options (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  item_id UUID NOT NULL REFERENCES items(id) ON DELETE CASCADE,

  option_name VARCHAR(100) NOT NULL,
  option_value VARCHAR(100),

  -- ì¶”ê°€ ì¬ë£Œ
  additional_ingredient_id UUID REFERENCES items(id),
  additional_quantity DECIMAL(10, 3),
  additional_unit unit_type,

  -- ì¶”ê°€ ê°€ê²©
  price_adjustment DECIMAL(10, 2) DEFAULT 0,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_item_options_item ON item_options(item_id);
```

### 3.4 ì¬ê³  ê´€ë¦¬ í…Œì´ë¸”

```sql
-- ============================================
-- 10. Inventory (í˜„ì¬ ì¬ê³ )
-- ============================================
CREATE TABLE inventory (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  item_id UUID NOT NULL REFERENCES items(id) ON DELETE CASCADE,

  -- ì¬ê³  ìˆ˜ëŸ‰
  theoretical_quantity DECIMAL(10, 3) DEFAULT 0,
  physical_quantity DECIMAL(10, 3),

  -- ì°¨ì´ ë¶„ì„
  variance DECIMAL(10, 3) GENERATED ALWAYS AS
    (physical_quantity - theoretical_quantity) STORED,
  variance_percent DECIMAL(5, 2),

  last_physical_count_at TIMESTAMP,
  last_updated_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(store_id, item_id)
);

CREATE INDEX idx_inventory_store ON inventory(store_id);
CREATE INDEX idx_inventory_item ON inventory(item_id);

-- ============================================
-- 11. Inventory_Transactions (ì¬ê³  ì´ë™ ë‚´ì—­)
-- ============================================
CREATE TABLE inventory_transactions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  item_id UUID NOT NULL REFERENCES items(id) ON DELETE CASCADE,

  transaction_type transaction_type NOT NULL,
  quantity DECIMAL(10, 3) NOT NULL,
  unit unit_type NOT NULL,

  -- ì°¸ì¡° ì •ë³´
  reference_type VARCHAR(50),
  reference_id UUID,

  -- ë¹„ìš© ì •ë³´
  unit_cost DECIMAL(10, 2),
  total_cost DECIMAL(10, 2),

  notes TEXT,
  transaction_date DATE NOT NULL,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_inv_trans_store ON inventory_transactions(store_id);
CREATE INDEX idx_inv_trans_item ON inventory_transactions(item_id);
CREATE INDEX idx_inv_trans_date ON inventory_transactions(transaction_date DESC);
CREATE INDEX idx_inv_trans_type ON inventory_transactions(transaction_type);

-- ============================================
-- 12. Inventory_Lots (FIFO ë¡œíŠ¸)
-- ============================================
CREATE TABLE inventory_lots (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  item_id UUID NOT NULL REFERENCES items(id) ON DELETE CASCADE,

  lot_number VARCHAR(100),

  quantity DECIMAL(10, 3) NOT NULL,
  remaining_quantity DECIMAL(10, 3) NOT NULL,
  unit unit_type NOT NULL,

  received_date DATE NOT NULL,
  expiry_date DATE,

  unit_cost DECIMAL(10, 2),

  purchase_order_item_id UUID,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_lots_store ON inventory_lots(store_id);
CREATE INDEX idx_lots_item ON inventory_lots(item_id);
CREATE INDEX idx_lots_expiry ON inventory_lots(expiry_date) WHERE expiry_date IS NOT NULL;
CREATE INDEX idx_lots_fifo ON inventory_lots(item_id, received_date);

-- ============================================
-- 13. Physical_Counts (ì‹¤ì‚¬)
-- ============================================
CREATE TABLE physical_counts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  count_date DATE NOT NULL,
  count_type VARCHAR(50),
  zone VARCHAR(100),

  status VARCHAR(20) DEFAULT 'in_progress',

  counted_by UUID REFERENCES users(id),
  verified_by UUID REFERENCES users(id),

  notes TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP
);

CREATE INDEX idx_pc_store ON physical_counts(store_id);
CREATE INDEX idx_pc_date ON physical_counts(count_date DESC);

-- ============================================
-- 14. Physical_Count_Items (ì‹¤ì‚¬ ìƒì„¸)
-- ============================================
CREATE TABLE physical_count_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  physical_count_id UUID NOT NULL REFERENCES physical_counts(id) ON DELETE CASCADE,
  item_id UUID NOT NULL REFERENCES items(id),

  counted_quantity DECIMAL(10, 3) NOT NULL,
  unit unit_type NOT NULL,

  system_quantity DECIMAL(10, 3),

  variance DECIMAL(10, 3) GENERATED ALWAYS AS
    (counted_quantity - system_quantity) STORED,

  adjustment_reason VARCHAR(100),
  notes TEXT,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_pci_pc ON physical_count_items(physical_count_id);
CREATE INDEX idx_pci_item ON physical_count_items(item_id);
```

### 3.5 êµ¬ë§¤ ê´€ë¦¬ í…Œì´ë¸”

```sql
-- ============================================
-- 15. Suppliers (ê±°ë˜ì²˜)
-- ============================================
CREATE TABLE suppliers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  name VARCHAR(255) NOT NULL,
  business_number VARCHAR(20),

  contact_person VARCHAR(100),
  phone VARCHAR(20),
  email VARCHAR(255),
  address TEXT,

  payment_terms TEXT,
  delivery_days INT,

  is_active BOOLEAN DEFAULT true,
  notes TEXT,

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_suppliers_store ON suppliers(store_id);

-- ============================================
-- 16. Purchase_Orders (ë°œì£¼)
-- ============================================
CREATE TABLE purchase_orders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  po_number VARCHAR(50) UNIQUE,
  supplier_id UUID REFERENCES suppliers(id),

  status po_status DEFAULT 'draft',

  order_date DATE,
  expected_delivery_date DATE,
  received_date DATE,

  total_amount DECIMAL(10, 2),

  notes TEXT,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_po_store ON purchase_orders(store_id);
CREATE INDEX idx_po_supplier ON purchase_orders(supplier_id);
CREATE INDEX idx_po_status ON purchase_orders(status);

-- ============================================
-- 17. Purchase_Order_Items (ë°œì£¼ ìƒì„¸)
-- ============================================
CREATE TABLE purchase_order_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  purchase_order_id UUID NOT NULL REFERENCES purchase_orders(id) ON DELETE CASCADE,
  item_id UUID NOT NULL REFERENCES items(id),

  ordered_quantity DECIMAL(10, 3) NOT NULL,
  received_quantity DECIMAL(10, 3) DEFAULT 0,
  unit unit_type NOT NULL,

  unit_price DECIMAL(10, 2),

  expiry_date DATE,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_poi_po ON purchase_order_items(purchase_order_id);
CREATE INDEX idx_poi_item ON purchase_order_items(item_id);
```

### 3.6 íŒë§¤ ê´€ë¦¬ í…Œì´ë¸”

```sql
-- ============================================
-- 18. Sales (íŒë§¤)
-- ============================================
CREATE TABLE sales (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,

  order_number VARCHAR(100),
  channel VARCHAR(50), -- 'pos', 'baemin', 'coupang'
  total_amount DECIMAL(10, 2),

  sale_date DATE NOT NULL,
  sale_time TIME,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_sales_store ON sales(store_id);
CREATE INDEX idx_sales_date ON sales(sale_date DESC);
CREATE INDEX idx_sales_channel ON sales(channel);

-- ============================================
-- 19. Sales_Items (íŒë§¤ ìƒì„¸)
-- ============================================
CREATE TABLE sales_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  sale_id UUID NOT NULL REFERENCES sales(id) ON DELETE CASCADE,
  item_id UUID NOT NULL REFERENCES items(id),

  quantity DECIMAL(10, 3) NOT NULL,
  unit_price DECIMAL(10, 2),

  options JSONB,

  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_sales_items_sale ON sales_items(sale_id);
CREATE INDEX idx_sales_items_item ON sales_items(item_id);
```

### 3.7 ìœ í‹¸ë¦¬í‹° í…Œì´ë¸”

```sql
-- ============================================
-- 20. Unit_Conversions (ë‹¨ìœ„ ë³€í™˜)
-- ============================================
CREATE TABLE unit_conversions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  from_unit unit_type NOT NULL,
  to_unit unit_type NOT NULL,
  conversion_factor DECIMAL(15, 6) NOT NULL,

  item_id UUID REFERENCES items(id),

  created_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(from_unit, to_unit, item_id)
);

CREATE INDEX idx_unit_conv_from_to ON unit_conversions(from_unit, to_unit);
```

---

## 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ

### Phase 1: ê¸°ë°˜ êµ¬ì¡° (1ì£¼ì°¨)

```sql
-- 1. ENUM íƒ€ì… ìƒì„±
CREATE TYPE item_type AS ENUM ...;
CREATE TYPE unit_type AS ENUM ...;
CREATE TYPE transaction_type AS ENUM ...;
CREATE TYPE po_status AS ENUM ...;

-- 2. Multi-tenancy í…Œì´ë¸”
CREATE TABLE organizations;
CREATE TABLE stores;
CREATE TABLE users;
CREATE TABLE user_roles;

-- 3. ë‹¨ìœ„ ë³€í™˜ í…Œì´ë¸”
CREATE TABLE unit_conversions;
```

### Phase 2: ì œí’ˆ & BOM (2ì£¼ì°¨)

```sql
-- 4. ì œí’ˆ ê´€ë ¨ í…Œì´ë¸”
CREATE TABLE categories;
CREATE TABLE items;
CREATE TABLE recipes;
CREATE TABLE recipe_items;
CREATE TABLE item_options;
```

### Phase 3: ì¬ê³  & êµ¬ë§¤ (5-6ì£¼ì°¨)

```sql
-- 5. ì¬ê³  ê´€ë ¨ í…Œì´ë¸”
CREATE TABLE inventory;
CREATE TABLE inventory_transactions;
CREATE TABLE inventory_lots;
CREATE TABLE physical_counts;
CREATE TABLE physical_count_items;

-- 6. êµ¬ë§¤ ê´€ë ¨ í…Œì´ë¸”
CREATE TABLE suppliers;
CREATE TABLE purchase_orders;
CREATE TABLE purchase_order_items;
```

### Phase 4: íŒë§¤ (3-4ì£¼ì°¨)

```sql
-- 7. íŒë§¤ ê´€ë ¨ í…Œì´ë¸”
CREATE TABLE sales;
CREATE TABLE sales_items;
```

---

## 5. ì´ˆê¸° ë°ì´í„°

### 5.1 ë‹¨ìœ„ ë³€í™˜ ê¸°ë³¸ ë°ì´í„°

```sql
-- ë²”ìš© ë‹¨ìœ„ ë³€í™˜
INSERT INTO unit_conversions (from_unit, to_unit, conversion_factor) VALUES
  ('kg', 'g', 1000),
  ('g', 'kg', 0.001),
  ('l', 'ml', 1000),
  ('ml', 'l', 0.001),
  ('box', 'ea', 12),
  ('pack', 'g', 500);
```

### 5.2 ìƒ˜í”Œ Organization

```sql
INSERT INTO organizations (name, slug, subscription_plan) VALUES
  ('BSM ë² ì´ì»¤ë¦¬', 'bsm-bakery', 'pro'),
  ('í…ŒìŠ¤íŠ¸ ì¹´í˜', 'test-cafe', 'trial');
```

### 5.3 ìƒ˜í”Œ Store

```sql
INSERT INTO stores (organization_id, name, code, address) VALUES
  (
    (SELECT id FROM organizations WHERE slug = 'bsm-bakery'),
    'í¬í‹€ë¦¬ì—ì ',
    'PTL',
    'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ...'
  );
```

---

## 6. RLS ì •ì±… ì „ì²´

### 6.1 ê¸°ë³¸ RLS ì •ì±… í…œí”Œë¦¿

```sql
-- ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸”ì— ì ìš©í•  í‘œì¤€ RLS

-- SELECT ì •ì±…
CREATE POLICY {table}_select_policy ON {table}
  FOR SELECT
  USING (
    store_id IN (
      SELECT store_id
      FROM user_roles
      WHERE user_id = auth.uid()
    )
  );

-- INSERT ì •ì±… (ë§¤ë‹ˆì € ì´ìƒ)
CREATE POLICY {table}_insert_policy ON {table}
  FOR INSERT
  WITH CHECK (
    EXISTS (
      SELECT 1
      FROM user_roles
      WHERE user_id = auth.uid()
        AND store_id = {table}.store_id
        AND role IN ('owner', 'manager')
    )
  );

-- UPDATE ì •ì±…
CREATE POLICY {table}_update_policy ON {table}
  FOR UPDATE
  USING (
    store_id IN (
      SELECT store_id
      FROM user_roles
      WHERE user_id = auth.uid()
        AND role IN ('owner', 'manager')
    )
  );

-- DELETE ì •ì±… (ì˜¤ë„ˆë§Œ)
CREATE POLICY {table}_delete_policy ON {table}
  FOR DELETE
  USING (
    store_id IN (
      SELECT store_id
      FROM user_roles
      WHERE user_id = auth.uid()
        AND role = 'owner'
    )
  );
```

### 6.2 ì ìš©í•  í…Œì´ë¸” ëª©ë¡

```sql
-- RLS í™œì„±í™” ë° ì •ì±… ì ìš©
ALTER TABLE items ENABLE ROW LEVEL SECURITY;
ALTER TABLE recipes ENABLE ROW LEVEL SECURITY;
ALTER TABLE inventory ENABLE ROW LEVEL SECURITY;
ALTER TABLE inventory_transactions ENABLE ROW LEVEL SECURITY;
ALTER TABLE sales ENABLE ROW LEVEL SECURITY;
ALTER TABLE purchase_orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE suppliers ENABLE ROW LEVEL SECURITY;
ALTER TABLE physical_counts ENABLE ROW LEVEL SECURITY;

-- ê° í…Œì´ë¸”ì— ìœ„ ì •ì±… ì ìš©
-- (ìœ„ í…œí”Œë¦¿ì˜ {table}ì„ ì‹¤ì œ í…Œì´ë¸”ëª…ìœ¼ë¡œ ì¹˜í™˜)
```

---

## 7. ì¸ë±ìŠ¤ ì „ëµ

### 7.1 ì„±ëŠ¥ ìµœì í™” ë³µí•© ì¸ë±ìŠ¤

```sql
-- íŒë§¤ ë°ì´í„° ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_sales_store_date_channel
  ON sales(store_id, sale_date DESC, channel);

-- ì¬ê³  ê±°ë˜ ë‚´ì—­ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_inv_trans_store_date_type
  ON inventory_transactions(store_id, transaction_date DESC, transaction_type);

-- ì¬ê³  ë¶€ì¡± í’ˆëª© ë¹ ë¥¸ ì¡°íšŒ
CREATE INDEX idx_inventory_low_stock
  ON inventory(store_id, item_id)
  WHERE theoretical_quantity < (
    SELECT safety_stock FROM items WHERE id = item_id
  );

-- FIFO ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_lots_fifo_composite
  ON inventory_lots(store_id, item_id, received_date)
  WHERE remaining_quantity > 0;

-- ë ˆì‹œí”¼ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_recipes_store_output_active
  ON recipes(store_id, output_item_id)
  WHERE is_active = true;
```

---

## 8. ë·° ë° í•¨ìˆ˜

### 8.1 Materialized View: BOM ì „ê°œ

```sql
CREATE MATERIALIZED VIEW mv_flattened_bom AS
WITH RECURSIVE bom_tree AS (
  -- 1ë‹¨ê³„: ì§ì ‘ ì¬ë£Œ
  SELECT
    r.output_item_id AS product_id,
    ri.input_item_id AS material_id,
    ri.quantity,
    ri.unit,
    1 AS level
  FROM recipes r
  JOIN recipe_items ri ON ri.recipe_id = r.id
  WHERE r.is_active = true

  UNION ALL

  -- 2ë‹¨ê³„ ì´ìƒ: ì¬ë£Œì˜ ì¬ë£Œ
  SELECT
    bt.product_id,
    ri.input_item_id,
    bt.quantity * ri.quantity,
    ri.unit,
    bt.level + 1
  FROM bom_tree bt
  JOIN items i ON i.id = bt.material_id
  JOIN recipes r ON r.output_item_id = i.id AND r.is_active = true
  JOIN recipe_items ri ON ri.recipe_id = r.id
  WHERE i.type != 'raw'
)
SELECT
  bt.product_id,
  p.name AS product_name,
  bt.material_id,
  m.name AS material_name,
  SUM(bt.quantity) AS total_quantity,
  bt.unit
FROM bom_tree bt
JOIN items p ON p.id = bt.product_id
JOIN items m ON m.id = bt.material_id
WHERE m.type = 'raw'
GROUP BY bt.product_id, p.name, bt.material_id, m.name, bt.unit;

CREATE INDEX idx_mv_bom_product ON mv_flattened_bom(product_id);
CREATE INDEX idx_mv_bom_material ON mv_flattened_bom(material_id);
```

### 8.2 í•µì‹¬ í•¨ìˆ˜ë“¤

```sql
-- 1. ë‹¨ìœ„ ë³€í™˜ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION convert_unit(
  p_quantity DECIMAL,
  p_from_unit unit_type,
  p_to_unit unit_type,
  p_item_id UUID DEFAULT NULL
) RETURNS DECIMAL AS $$
DECLARE
  v_factor DECIMAL;
BEGIN
  IF p_from_unit = p_to_unit THEN
    RETURN p_quantity;
  END IF;

  SELECT conversion_factor INTO v_factor
  FROM unit_conversions
  WHERE from_unit = p_from_unit
    AND to_unit = p_to_unit
    AND (item_id = p_item_id OR item_id IS NULL)
  ORDER BY item_id DESC NULLS LAST
  LIMIT 1;

  IF v_factor IS NULL THEN
    RAISE EXCEPTION 'No conversion found: % to %', p_from_unit, p_to_unit;
  END IF;

  RETURN p_quantity * v_factor;
END;
$$ LANGUAGE plpgsql;

-- 2. ì œí’ˆ ì›ê°€ ê³„ì‚° í•¨ìˆ˜
CREATE OR REPLACE FUNCTION calculate_product_cost(p_item_id UUID)
RETURNS TABLE(
  raw_material VARCHAR,
  quantity DECIMAL,
  unit VARCHAR,
  unit_price DECIMAL,
  total_cost DECIMAL
) AS $$
BEGIN
  RETURN QUERY
  SELECT
    m.material_name::VARCHAR,
    m.total_quantity,
    m.unit::VARCHAR,
    i.latest_purchase_price,
    m.total_quantity * i.latest_purchase_price
  FROM mv_flattened_bom m
  JOIN items i ON i.id = m.material_id
  WHERE m.product_id = p_item_id;
END;
$$ LANGUAGE plpgsql;

-- 3. ì•ˆì „ì¬ê³  ì´í•˜ í’ˆëª© ì¡°íšŒ
CREATE OR REPLACE FUNCTION get_low_stock_items(p_store_id UUID)
RETURNS TABLE(
  item_name VARCHAR,
  current_quantity DECIMAL,
  safety_stock DECIMAL,
  shortage DECIMAL
) AS $$
BEGIN
  RETURN QUERY
  SELECT
    i.name::VARCHAR,
    inv.theoretical_quantity,
    i.safety_stock,
    (i.safety_stock - inv.theoretical_quantity) AS shortage
  FROM inventory inv
  JOIN items i ON i.id = inv.item_id
  WHERE inv.store_id = p_store_id
    AND inv.theoretical_quantity < i.safety_stock
    AND i.is_inventory_managed = true
  ORDER BY shortage DESC;
END;
$$ LANGUAGE plpgsql;

-- 4. ìœ í†µê¸°í•œ ì„ë°• í’ˆëª© ì¡°íšŒ
CREATE OR REPLACE FUNCTION get_expiring_items(
  p_store_id UUID,
  p_days_threshold INT DEFAULT 7
) RETURNS TABLE(
  item_name VARCHAR,
  lot_number VARCHAR,
  remaining_quantity DECIMAL,
  expiry_date DATE,
  days_until_expiry INT
) AS $$
BEGIN
  RETURN QUERY
  SELECT
    i.name::VARCHAR,
    il.lot_number::VARCHAR,
    il.remaining_quantity,
    il.expiry_date,
    (il.expiry_date - CURRENT_DATE)::INT
  FROM inventory_lots il
  JOIN items i ON i.id = il.item_id
  WHERE il.store_id = p_store_id
    AND il.expiry_date IS NOT NULL
    AND il.expiry_date <= CURRENT_DATE + p_days_threshold
    AND il.remaining_quantity > 0
  ORDER BY il.expiry_date ASC;
END;
$$ LANGUAGE plpgsql;

-- 5. ì‹¤ì‚¬ ì‹œì‘
CREATE OR REPLACE FUNCTION start_physical_count(
  p_store_id UUID,
  p_count_date DATE,
  p_zone VARCHAR,
  p_user_id UUID
) RETURNS UUID AS $$
DECLARE
  v_count_id UUID;
BEGIN
  INSERT INTO physical_counts (
    store_id,
    count_date,
    count_type,
    zone,
    counted_by
  ) VALUES (
    p_store_id,
    p_count_date,
    'spot',
    p_zone,
    p_user_id
  ) RETURNING id INTO v_count_id;

  RETURN v_count_id;
END;
$$ LANGUAGE plpgsql;

-- 6. ì‹¤ì‚¬ í•­ëª© ê¸°ë¡
CREATE OR REPLACE FUNCTION record_count_item(
  p_count_id UUID,
  p_item_id UUID,
  p_counted_quantity DECIMAL,
  p_unit unit_type,
  p_notes TEXT DEFAULT NULL
) RETURNS VOID AS $$
DECLARE
  v_system_qty DECIMAL;
BEGIN
  SELECT theoretical_quantity INTO v_system_qty
  FROM inventory
  WHERE store_id = (SELECT store_id FROM physical_counts WHERE id = p_count_id)
    AND item_id = p_item_id;

  INSERT INTO physical_count_items (
    physical_count_id,
    item_id,
    counted_quantity,
    unit,
    system_quantity,
    notes
  ) VALUES (
    p_count_id,
    p_item_id,
    p_counted_quantity,
    p_unit,
    COALESCE(v_system_qty, 0),
    p_notes
  );
END;
$$ LANGUAGE plpgsql;

-- 7. ì‹¤ì‚¬ ì™„ë£Œ ë° ì¬ê³  ì¡°ì •
CREATE OR REPLACE FUNCTION complete_physical_count(p_count_id UUID)
RETURNS VOID AS $$
DECLARE
  v_item RECORD;
  v_store_id UUID;
  v_count_date DATE;
BEGIN
  SELECT store_id, count_date INTO v_store_id, v_count_date
  FROM physical_counts
  WHERE id = p_count_id;

  FOR v_item IN
    SELECT
      item_id,
      counted_quantity,
      system_quantity,
      variance,
      unit
    FROM physical_count_items
    WHERE physical_count_id = p_count_id
  LOOP
    UPDATE inventory
    SET
      physical_quantity = v_item.counted_quantity,
      theoretical_quantity = v_item.counted_quantity,
      last_physical_count_at = NOW(),
      last_updated_at = NOW()
    WHERE store_id = v_store_id
      AND item_id = v_item.item_id;

    IF v_item.variance != 0 THEN
      INSERT INTO inventory_transactions (
        store_id,
        item_id,
        transaction_type,
        quantity,
        unit,
        reference_type,
        reference_id,
        transaction_date,
        notes
      ) VALUES (
        v_store_id,
        v_item.item_id,
        'adjustment',
        v_item.variance,
        v_item.unit,
        'physical_count',
        p_count_id,
        v_count_date,
        'Physical count adjustment'
      );
    END IF;
  END LOOP;

  UPDATE physical_counts
  SET
    status = 'completed',
    completed_at = NOW()
  WHERE id = p_count_id;
END;
$$ LANGUAGE plpgsql;
```

### 8.3 íŠ¸ë¦¬ê±°

```sql
-- íŒë§¤ ì‹œ ì¬ê³  ìë™ ì°¨ê°
CREATE OR REPLACE FUNCTION process_sale_inventory()
RETURNS TRIGGER AS $$
DECLARE
  v_material RECORD;
  v_store_id UUID;
  v_sale_date DATE;
BEGIN
  -- íŒë§¤ ì •ë³´ ì¡°íšŒ
  SELECT store_id, sale_date INTO v_store_id, v_sale_date
  FROM sales WHERE id = NEW.sale_id;

  -- BOM ê¸°ë°˜ ì¬ë£Œ ì°¨ê°
  FOR v_material IN
    SELECT
      material_id,
      total_quantity,
      unit
    FROM mv_flattened_bom
    WHERE product_id = NEW.item_id
  LOOP
    -- Inventory ì—…ë°ì´íŠ¸
    UPDATE inventory
    SET
      theoretical_quantity = theoretical_quantity - (v_material.total_quantity * NEW.quantity),
      last_updated_at = NOW()
    WHERE store_id = v_store_id
      AND item_id = v_material.material_id;

    -- Transaction ê¸°ë¡
    INSERT INTO inventory_transactions (
      store_id,
      item_id,
      transaction_type,
      quantity,
      unit,
      reference_type,
      reference_id,
      transaction_date
    ) VALUES (
      v_store_id,
      v_material.material_id,
      'sale',
      -(v_material.total_quantity * NEW.quantity),
      v_material.unit,
      'sale_item',
      NEW.id,
      v_sale_date
    );
  END LOOP;

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_sale_inventory_deduction
  AFTER INSERT ON sales_items
  FOR EACH ROW
  EXECUTE FUNCTION process_sale_inventory();

-- ì…ê³  ì‹œ ì¬ê³  ì¦ê°€
CREATE OR REPLACE FUNCTION process_purchase_receipt()
RETURNS TRIGGER AS $$
DECLARE
  v_store_id UUID;
  v_received_date DATE;
BEGIN
  -- ë°œì£¼ ì •ë³´ ì¡°íšŒ
  SELECT store_id, received_date INTO v_store_id, v_received_date
  FROM purchase_orders WHERE id = NEW.purchase_order_id;

  -- Inventory ì—…ë°ì´íŠ¸
  INSERT INTO inventory (store_id, item_id, theoretical_quantity)
  VALUES (v_store_id, NEW.item_id, NEW.received_quantity)
  ON CONFLICT (store_id, item_id)
  DO UPDATE SET
    theoretical_quantity = inventory.theoretical_quantity + NEW.received_quantity,
    last_updated_at = NOW();

  -- Transaction ê¸°ë¡
  INSERT INTO inventory_transactions (
    store_id,
    item_id,
    transaction_type,
    quantity,
    unit,
    unit_cost,
    total_cost,
    reference_type,
    reference_id,
    transaction_date
  ) VALUES (
    v_store_id,
    NEW.item_id,
    'purchase',
    NEW.received_quantity,
    NEW.unit,
    NEW.unit_price,
    NEW.received_quantity * NEW.unit_price,
    'purchase_order',
    NEW.purchase_order_id,
    v_received_date
  );

  -- Lot ìƒì„±
  INSERT INTO inventory_lots (
    store_id,
    item_id,
    lot_number,
    quantity,
    remaining_quantity,
    unit,
    received_date,
    expiry_date,
    unit_cost,
    purchase_order_item_id
  ) VALUES (
    v_store_id,
    NEW.item_id,
    'LOT-' || TO_CHAR(NOW(), 'YYYYMMDD') || '-' || NEW.id,
    NEW.received_quantity,
    NEW.received_quantity,
    NEW.unit,
    v_received_date,
    NEW.expiry_date,
    NEW.unit_price,
    NEW.id
  );

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_purchase_receipt_inventory
  AFTER UPDATE OF received_quantity ON purchase_order_items
  FOR EACH ROW
  WHEN (OLD.received_quantity IS DISTINCT FROM NEW.received_quantity)
  EXECUTE FUNCTION process_purchase_receipt();
```

---

## 9. ì‹¤í–‰ ìˆœì„œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… 1ë‹¨ê³„: ê¸°ë³¸ êµ¬ì¡° (1ì£¼ì°¨)

```bash
# Supabase SQL Editorì—ì„œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰

# 1. ENUM íƒ€ì… ìƒì„±
- [ ] item_type
- [ ] unit_type
- [ ] transaction_type
- [ ] po_status

# 2. Multi-tenancy í…Œì´ë¸”
- [ ] organizations
- [ ] stores
- [ ] users
- [ ] user_roles

# 3. ë‹¨ìœ„ ë³€í™˜
- [ ] unit_conversions
- [ ] ê¸°ë³¸ ë°ì´í„° ì‚½ì…
```

### âœ… 2ë‹¨ê³„: ì œí’ˆ & BOM (2ì£¼ì°¨)

```bash
# 4. ì œí’ˆ í…Œì´ë¸”
- [ ] categories
- [ ] items
- [ ] recipes
- [ ] recipe_items
- [ ] item_options

# 5. BOM ë·° ë° í•¨ìˆ˜
- [ ] mv_flattened_bom
- [ ] convert_unit()
- [ ] calculate_product_cost()
```

### âœ… 3ë‹¨ê³„: ì¬ê³  & íŒë§¤ (5-6ì£¼ì°¨)

```bash
# 6. ì¬ê³  í…Œì´ë¸”
- [ ] inventory
- [ ] inventory_transactions
- [ ] inventory_lots
- [ ] physical_counts
- [ ] physical_count_items

# 7. íŒë§¤ í…Œì´ë¸”
- [ ] sales
- [ ] sales_items

# 8. ì¬ê³  í•¨ìˆ˜ ë° íŠ¸ë¦¬ê±°
- [ ] process_sale_inventory() íŠ¸ë¦¬ê±°
- [ ] get_low_stock_items()
- [ ] get_expiring_items()
- [ ] start_physical_count()
- [ ] record_count_item()
- [ ] complete_physical_count()
```

### âœ… 4ë‹¨ê³„: êµ¬ë§¤ (6ì£¼ì°¨)

```bash
# 9. êµ¬ë§¤ í…Œì´ë¸”
- [ ] suppliers
- [ ] purchase_orders
- [ ] purchase_order_items

# 10. êµ¬ë§¤ íŠ¸ë¦¬ê±°
- [ ] process_purchase_receipt()
```

### âœ… 5ë‹¨ê³„: RLS ë° ì¸ë±ìŠ¤ (ì „ì²´)

```bash
# 11. RLS í™œì„±í™” ë° ì •ì±… ì ìš©
- [ ] ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸” RLS í™œì„±í™”
- [ ] SELECT/INSERT/UPDATE/DELETE ì •ì±… ìƒì„±

# 12. ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤
- [ ] ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
- [ ] ì¡°ê±´ë¶€ ì¸ë±ìŠ¤ ìƒì„±
```

---

## 10. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì˜ˆì‹œ

### 10.1 Organization & Store

```sql
-- Organization
INSERT INTO organizations (id, name, slug, subscription_plan)
VALUES
  ('550e8400-e29b-41d4-a716-446655440000', 'BSM ë² ì´ì»¤ë¦¬', 'bsm-bakery', 'pro');

-- Store
INSERT INTO stores (id, organization_id, name, code)
VALUES
  ('660e8400-e29b-41d4-a716-446655440000',
   '550e8400-e29b-41d4-a716-446655440000',
   'í¬í‹€ë¦¬ì—ì ',
   'PTL');
```

### 10.2 Categories & Items

```sql
-- ì¹´í…Œê³ ë¦¬
INSERT INTO categories (id, store_id, name) VALUES
  ('cat-001', '660e8400-e29b-41d4-a716-446655440000', 'ë¹µë¥˜'),
  ('cat-002', '660e8400-e29b-41d4-a716-446655440000', 'ìŒë£Œ');

-- ì›ìì¬
INSERT INTO items (id, store_id, code, name, type, base_unit, latest_purchase_price, safety_stock)
VALUES
  ('item-flour', '660e8400-e29b-41d4-a716-446655440000', 'RAW-001', 'ë°•ë ¥ë¶„', 'raw', 'kg', 5.00, 10),
  ('item-butter', '660e8400-e29b-41d4-a716-446655440000', 'RAW-002', 'ë²„í„°', 'raw', 'kg', 15.00, 5),
  ('item-sugar', '660e8400-e29b-41d4-a716-446655440000', 'RAW-003', 'ì„¤íƒ•', 'raw', 'kg', 3.00, 5);

-- ì™„ì œí’ˆ
INSERT INTO items (id, store_id, code, name, type, category_id, base_unit, sale_price)
VALUES
  ('item-croissant', '660e8400-e29b-41d4-a716-446655440000',
   'FIN-001', 'í¬ë¡œì™€ìƒ', 'finished', 'cat-001', 'ea', 4500);
```

### 10.3 Recipe (BOM)

```sql
-- í¬ë¡œì™€ìƒ ë ˆì‹œí”¼
INSERT INTO recipes (id, store_id, output_item_id, output_quantity, is_active)
VALUES
  ('recipe-croissant', '660e8400-e29b-41d4-a716-446655440000',
   'item-croissant', 1, true);

-- ë ˆì‹œí”¼ ìƒì„¸ (1ê°œ ìƒì‚° ê¸°ì¤€)
INSERT INTO recipe_items (recipe_id, input_item_id, quantity, unit) VALUES
  ('recipe-croissant', 'item-flour', 50, 'g'),
  ('recipe-croissant', 'item-butter', 25, 'g'),
  ('recipe-croissant', 'item-sugar', 5, 'g');
```

### 10.4 Inventory ì´ˆê¸°í™”

```sql
-- ì´ˆê¸° ì¬ê³  ì„¤ì •
INSERT INTO inventory (store_id, item_id, theoretical_quantity, physical_quantity)
VALUES
  ('660e8400-e29b-41d4-a716-446655440000', 'item-flour', 20, 20),
  ('660e8400-e29b-41d4-a716-446655440000', 'item-butter', 10, 10),
  ('660e8400-e29b-41d4-a716-446655440000', 'item-sugar', 5, 5);
```

### 10.5 Sales (íŒë§¤ í…ŒìŠ¤íŠ¸)

```sql
-- íŒë§¤ ìƒì„±
INSERT INTO sales (id, store_id, order_number, channel, total_amount, sale_date)
VALUES
  ('sale-001', '660e8400-e29b-41d4-a716-446655440000',
   'ORD-001', 'pos', 9000, CURRENT_DATE);

-- íŒë§¤ ìƒì„¸ (í¬ë¡œì™€ìƒ 2ê°œ)
INSERT INTO sales_items (sale_id, item_id, quantity, unit_price)
VALUES
  ('sale-001', 'item-croissant', 2, 4500);

-- ì´ ì‹œì ì— íŠ¸ë¦¬ê±°ê°€ ë°œë™í•˜ì—¬ ìë™ìœ¼ë¡œ:
-- 1. inventory í…Œì´ë¸”ì—ì„œ ë°•ë ¥ë¶„ 100g, ë²„í„° 50g, ì„¤íƒ• 10g ì°¨ê°
-- 2. inventory_transactionsì— ê¸°ë¡ ìƒì„±
```

---

## 11. ê²€ì¦ ì¿¼ë¦¬

### 11.1 BOM ì •ìƒ ì‘ë™ í™•ì¸

```sql
-- í¬ë¡œì™€ìƒì˜ ì „ì²´ ì›ìì¬ ì¡°íšŒ
SELECT * FROM mv_flattened_bom
WHERE product_id = 'item-croissant';

-- ì˜ˆìƒ ê²°ê³¼:
-- material_name: ë°•ë ¥ë¶„, total_quantity: 50, unit: g
-- material_name: ë²„í„°, total_quantity: 25, unit: g
-- material_name: ì„¤íƒ•, total_quantity: 5, unit: g
```

### 11.2 ì¬ê³  ì°¨ê° í™•ì¸

```sql
-- íŒë§¤ í›„ ì¬ê³  í™•ì¸
SELECT
  i.name,
  inv.theoretical_quantity
FROM inventory inv
JOIN items i ON i.id = inv.item_id
WHERE inv.store_id = '660e8400-e29b-41d4-a716-446655440000';

-- ì˜ˆìƒ ê²°ê³¼ (í¬ë¡œì™€ìƒ 2ê°œ íŒë§¤ í›„):
-- ë°•ë ¥ë¶„: 19.9 kg (20 - 0.1)
-- ë²„í„°: 9.95 kg (10 - 0.05)
-- ì„¤íƒ•: 4.99 kg (5 - 0.01)
```

### 11.3 ê±°ë˜ ë‚´ì—­ í™•ì¸

```sql
SELECT
  it.transaction_date,
  it.transaction_type,
  i.name,
  it.quantity,
  it.unit
FROM inventory_transactions it
JOIN items i ON i.id = it.item_id
WHERE it.store_id = '660e8400-e29b-41d4-a716-446655440000'
ORDER BY it.created_at DESC
LIMIT 10;
```

---

## ê²°ë¡ 

- âœ… **ì´ 19ê°œ í…Œì´ë¸”**ë¡œ F&B ë§¤ì¥ ì „ì²´ ìš´ì˜ ì»¤ë²„
- âœ… **Multi-tenancy** ì™„ë²½ ì§€ì› (SaaS ì¤€ë¹„ ì™„ë£Œ)
- âœ… **ë‹¤ë‹¨ê³„ BOM** ì¬ê·€ ì²˜ë¦¬
- âœ… **ì‹¤ì‹œê°„ ì¬ê³  ì¶”ì ** (ì´ë¡  + ì‹¤ì‚¬)
- âœ… **FIFO ìœ í†µê¸°í•œ ê´€ë¦¬**
- âœ… **RLS ë³´ì•ˆ** ë‚´ì¥
- âœ… **ì„±ëŠ¥ ìµœì í™”** ì¸ë±ìŠ¤ ì „ëµ